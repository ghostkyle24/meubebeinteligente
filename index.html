<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Beb√™ Inteligente - O lugar seguro e educativo para seu filho</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        // Fallback para QRCode se o CDN principal falhar
        if (typeof QRCode === 'undefined') {
            console.log('üîÑ Tentando carregar QRCode do CDN alternativo...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js';
            script.onload = function() {
                console.log('‚úÖ QRCode carregado do CDN alternativo');
            };
            script.onerror = function() {
                console.error('‚ùå Falha ao carregar QRCode do CDN alternativo');
                // Tentar terceiro CDN
                console.log('üîÑ Tentando terceiro CDN...');
                const script2 = document.createElement('script');
                script2.src = 'https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js';
                script2.onload = function() {
                    console.log('‚úÖ QRCode carregado do terceiro CDN');
                };
                script2.onerror = function() {
                    console.error('‚ùå Todos os CDNs falharam - usando fallback');
                };
                document.head.appendChild(script2);
            };
            document.head.appendChild(script);
        }
    </script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Configura√ß√µes inline para evitar problemas de carregamento
        const CONFIG = {
            // Supabase - Configura√ß√µes diretas
            SUPABASE_URL: 'https://htmofgizynztknpekfbu.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bW9mZ2l6eW56dGtucGVrZmJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MzYwMTYsImV4cCI6MjA3MzExMjAxNn0.a_3_-ncgdXkY2At0ougpZWsXuCrYe-T60RhezGPiE-w',
            
            // Pagar.me - Configura√ß√µes diretas
            PAGARME_API_KEY: 'sk_85c717614bea451eb81fa2b9e4b09109',
            
            // Admin - Configura√ß√µes diretas
            ADMIN_EMAIL: 'ashercongintencia@gmail.com',
            ADMIN_EMAIL_ALT: 'ashercontingencia@gmail.com',
            ADMIN_PASSWORD: 'DIVJroiDIVJ#18072002',
            
            // Configura√ß√µes do Site
            SITE_NAME: 'Meu Beb√™ Inteligente',
            SITE_URL: 'https://meubebeinteligente.vercel.app',
            
            // Meta Pixel
            META_PIXEL_ID: '636104805955276',
            META_ACCESS_TOKEN: 'EAAPZBiaTYbAkBPXrv4sDTGeaYKB8JOnArQvHHgGoQwtJGfS5VkHYb7Pvf8ISfUVWUR6Xk3rlD1f15DQPcniM6qy62hZCXIg75AUvEcseuzJnqTyGFIVf3y3DJRATxaHTXKccIHuagOjgaI3X2xFHJXddIMc71aHSMiYHYmIwoH7O5H1G9lha0HSSNg0QZDZD',
            
            // Planos
            PLANS: {
                monthly: { price: 29, duration: 1, period: 'month', name: 'Mensal' },
                quarterly: { price: 79, duration: 3, period: 'months', name: 'Trimestral' },
                yearly: { price: 290, duration: 12, period: 'months', name: 'Anual' }
            }
        };
    </script>
    <script src="meta-pixel-config.js"></script>
    
    <!-- Meta Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        
        // Pixel ser√° inicializado pelo meta-pixel-config.js
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
             src="https://www.facebook.com/tr?id=636104805955276&ev=PageView&noscript=1" />
    </noscript>
    <!-- End Meta Pixel Code -->
    <style>
        /* Menu mobile para navbar da p√°gina de vendas */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            color: var(--color-blue);
            cursor: pointer;
            z-index: 1002;
        }

        .nav-menu.mobile-open {
            display: flex !important;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            flex-direction: column;
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-lg);
            border-top: 1px solid var(--color-gray-light);
            z-index: 1001;
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
        }
        
        /* Estilos para os novos √≠cones de recursos */
        .feature-icon.devocional {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
        }
        
        .feature-icon.english {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        
        .feature-icon.censura {
            background: linear-gradient(135deg, #E74C3C, #C0392B);
        }
        
        /* Estilos para os cards de ilustra√ß√£o expandidos */
        .illustration-card {
            background: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-2xl);
            box-shadow: var(--shadow-lg);
            text-align: center;
            transition: transform 0.3s ease;
            margin-bottom: var(--spacing-lg);
        }
        
        .illustration-card:hover {
            transform: translateY(-5px);
        }
        
        .illustration-card i {
            font-size: var(--font-size-3xl);
            margin-bottom: var(--spacing-md);
            display: block;
        }
        
        .illustration-card span {
            font-weight: 600;
            color: var(--color-gray-dark);
            font-size: 1.1rem;
            display: block;
            margin-bottom: var(--spacing-sm);
        }
        
        .illustration-card p {
            color: var(--color-gray-medium);
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 0;
        }
        
        /* Cores dos √≠cones */
        .illustration-card.music i { color: var(--color-blue); }
        .illustration-card.video i { color: var(--color-pink); }
        .illustration-card.english i { color: #4facfe; }
        .illustration-card.color i { color: var(--color-green); }
        .illustration-card.family i { color: var(--color-pink); }
        .illustration-card.diy i { color: var(--color-orange); }
        .illustration-card.game i { color: var(--color-orange); }
        .illustration-card.devocional i { color: #8B5CF6; }
        .illustration-card.shield i { color: #E74C3C; }
        
        /* Grid responsivo para os cards */
        .hero-illustration {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            max-width: 100%;
            margin: 0 auto;
        }
        
        @media (max-width: 768px) {
            .hero-illustration {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .illustration-card {
                padding: var(--spacing-lg);
            }
            
            .illustration-card i {
                font-size: var(--font-size-2xl);
            }
            
            .illustration-card span {
                font-size: 1rem;
            }
            
            .illustration-card p {
                font-size: 0.85rem;
            }
        }
        
        /* Modal de Sucesso */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .success-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }
        
        .success-icon {
            font-size: 4rem;
            color: #28a745;
            margin-bottom: 1rem;
        }
        
        .success-content h2 {
            color: var(--color-primary);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        
        .success-details {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            text-align: left;
        }
        
        .success-details p {
            margin: 0.5rem 0;
            color: var(--color-gray-dark);
        }
        
        .success-message {
            color: var(--color-gray-medium);
            margin: 1.5rem 0;
            line-height: 1.6;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Melhorias no QR Code */
        .qr-code-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            margin: 1rem 0;
        }
        
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #qrcode canvas {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        /* Timer de pagamento */
        .payment-timer {
            margin-top: 1rem;
            padding: 0.5rem;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            color: #856404;
            font-weight: 500;
        }
        
        /* Bot√µes de a√ß√£o do pagamento */
        .payment-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .payment-actions .btn {
            flex: 1;
            max-width: 200px;
        }
        
        /* Modal de Login */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .login-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: slideUp 0.3s ease;
        }
        
        .login-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .login-header h2 {
            color: var(--color-primary);
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #999;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .login-form .form-group {
            margin-bottom: 1.5rem;
        }
        
        .login-form .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }
        
        .login-form .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        .login-form .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
        }
        
        .login-footer {
            margin-top: 1.5rem;
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }
        
        .login-footer p {
            color: #666;
            margin: 0;
        }
        
        .login-footer a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 600;
        }
        
        .login-footer a:hover {
            text-decoration: underline;
        }
        
        .admin-hint {
            margin-top: 1rem;
            padding: 0.5rem;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }
        
        .admin-hint small {
            color: #667eea;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .admin-hint i {
            color: #667eea;
        }
        
        /* Bot√£o de Login */
        .login-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            background: linear-gradient(135deg, #764ba2, #667eea);
        }
        
        .login-btn i {
            font-size: 16px;
        }
        
        /* Link login no mobile */
        .login-link {
            color: #667eea !important;
            font-weight: 600 !important;
        }
        
        .login-link:hover {
            color: #764ba2 !important;
        }
        
        .login-link i {
            margin-right: 8px;
        }
        
        /* Responsivo para mobile */
        @media (max-width: 768px) {
            .login-btn {
                width: 35px;
                height: 35px;
                margin-left: 5px;
            }
            
            .login-btn i {
                font-size: 14px;
            }
        }

        /* Estilos para se√ß√£o de cart√£o */
        .card-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-info h4 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-info p {
            color: rgba(255,255,255,0.9);
            margin-bottom: 15px;
        }

        .security-badges {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .badge {
            background: rgba(255,255,255,0.2);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(10px);
        }

        .card-form .form-group label {
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .card-form input {
            background: rgba(255,255,255,0.95);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 12px 15px;
            font-size: 16px;
            color: #333;
            transition: all 0.3s ease;
        }

        .card-form input:focus {
            background: white;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
            outline: none;
        }

        .form-help {
            color: rgba(255,255,255,0.8);
            font-size: 0.8em;
            margin-top: 5px;
            display: block;
        }

        .card-brands {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            justify-content: center;
        }

        .brand {
            background: rgba(255,255,255,0.2);
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }

        .btn-card {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            width: 100%;
            margin-top: 20px;
        }

        .btn-card:hover {
            background: linear-gradient(45deg, #45a049, #4CAF50);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn-card span {
            font-size: 1.1em;
        }

        .btn-card small {
            font-size: 0.8em;
            opacity: 0.9;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="nav-brand">
                    <i class="fas fa-heart"></i>
                    <span>Meu Beb√™ Inteligente</span>
                </div>
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-menu" id="navMenu">
                    <a href="#home" class="nav-link active">In√≠cio</a>
                    <a href="#features" class="nav-link">Recursos</a>
                    <a href="#pricing" class="nav-link">Pre√ßos</a>
                    <a href="#testimonials" class="nav-link">Depoimentos</a>
                    <button class="btn btn-primary" onclick="scrollToPricing()">Come√ßar Agora</button>
                    <button class="login-btn" onclick="openLoginModal()" title="Fazer Login">
                        <i class="fas fa-sign-in-alt"></i>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">
                    O lugar seguro e educativo onde seu filho pode aprender, brincar e se divertir sem culpa.
                </h1>
                <p class="hero-subtitle">
                    Playlists de m√∫sicas e v√≠deos realmente educativos, atividades offline criativas, brincadeiras em fam√≠lia e jogos interativos ‚Äî tudo em um s√≥ lugar, sem an√∫ncios, sem conte√∫dos impr√≥prios e com valores que voc√™ confia.
                </p>
                <div class="hero-cta">
                    <button class="btn btn-primary btn-large" onclick="scrollToPricing()">
                        <i class="fas fa-play"></i>
                        Quero meu acesso agora
                    </button>
                    <p class="hero-guarantee">‚ú® Garantia de 7 dias</p>
                </div>
            </div>
            <div class="hero-image">
                <div class="hero-illustration">
                    <div class="illustration-card music">
                        <i class="fas fa-music"></i>
                        <span>M√∫sicas Educativas</span>
                        <p>Playlists curadas com m√∫sicas que realmente ensinam cores, n√∫meros, valores e princ√≠pios crist√£os.</p>
                    </div>
                    <div class="illustration-card video">
                        <i class="fas fa-play-circle"></i>
                        <span>V√≠deos Seguros</span>
                        <p>Conte√∫do educativo selecionado e livre de an√∫ncios, sem distra√ß√µes ou conte√∫dos impr√≥prios.</p>
                    </div>
                    <div class="illustration-card english">
                        <i class="fas fa-globe"></i>
                        <span>Ingl√™s Infantil</span>
                        <p>30 aulas completas para aprender ingl√™s brincando com cores, animais, n√∫meros e muito mais.</p>
                    </div>
                    <div class="illustration-card color">
                        <i class="fas fa-palette"></i>
                        <span>Desenhos Crist√£os</span>
                        <p>PDFs imprim√≠veis com desenhos que ensinam valores b√≠blicos enquanto a crian√ßa se diverte.</p>
                    </div>
                    <div class="illustration-card family">
                        <i class="fas fa-heart"></i>
                        <span>Brincadeiras em Fam√≠lia</span>
                        <p>Atividades offline que fortalecem o v√≠nculo entre m√£e e filho, com jogos educativos e criativos.</p>
                    </div>
                    <div class="illustration-card diy">
                        <i class="fas fa-tools"></i>
                        <span>Brinquedos DIY</span>
                        <p>Ideias de brinquedos que a pr√≥pria crian√ßa pode criar, estimulando criatividade e independ√™ncia.</p>
                    </div>
                    <div class="illustration-card game">
                        <i class="fas fa-gamepad"></i>
                        <span>Jogos Interativos</span>
                        <p>Mini-jogos educativos dentro do pr√≥prio site: mem√≥ria, associa√ß√£o, quebra-cabe√ßas e muito mais.</p>
                    </div>
                    <div class="illustration-card devocional">
                        <i class="fas fa-pray"></i>
                        <span>Devocional Kids</span>
                        <p>Momentos especiais com Deus para crian√ßas, ensinando valores crist√£os de forma carinhosa e divertida.</p>
                    </div>
                    <div class="illustration-card shield">
                        <i class="fas fa-shield-alt"></i>
                        <span>Controle Parental</span>
                        <p>Ferramentas para proteger seu filho online e configurar controles parentais de forma segura.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Problem Section -->
    <section class="problem">
        <div class="container">
            <h2 class="section-title">Voc√™ se identifica com isso?</h2>
            <div class="problem-grid">
                <div class="problem-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Seu filho passa horas na tela sem aprender nada?</h3>
                </div>
                <div class="problem-item">
                    <i class="fas fa-shield-alt"></i>
                    <h3>Fica preocupada com os v√≠deos que aparecem mesmo em apps "para crian√ßas"?</h3>
                </div>
                <div class="problem-item">
                    <i class="fas fa-search"></i>
                    <h3>Quer oferecer algo seguro e educativo, mas n√£o encontra tudo em um s√≥ lugar?</h3>
                </div>
            </div>
            <div class="problem-conclusion">
                <h3>Voc√™ n√£o est√° sozinha.</h3>
                <p>Milhares de m√£es enfrentam os mesmos desafios todos os dias.</p>
            </div>
        </div>
    </section>

    <!-- Solution Section -->
    <section id="features" class="solution">
        <div class="container">
            <h2 class="section-title">Apresentamos o Meu Beb√™ Inteligente</h2>
            <p class="section-subtitle">Um espa√ßo digital pensado para m√£es que querem mais do que distra√ß√£o ‚Äî querem aprendizado, criatividade e seguran√ßa para seus filhos.</p>
            
            <div class="features-grid">
                <div class="feature-card" onclick="window.location.href='musicas.html'" style="cursor: pointer;">
                    <div class="feature-icon music">
                        <i class="fas fa-music"></i>
                    </div>
                    <h3>M√∫sicas Educativas de Verdade</h3>
                    <p>Playlists curadas com m√∫sicas que realmente ensinam cores, n√∫meros, valores e princ√≠pios crist√£os.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='videos.html'" style="cursor: pointer;">
                    <div class="feature-icon video">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <h3>V√≠deos Seguros do YouTube</h3>
                    <p>Conte√∫do educativo selecionado e livre de an√∫ncios, sem distra√ß√µes ou conte√∫dos impr√≥prios.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='ingles.html'" style="cursor: pointer;">
                    <div class="feature-icon english">
                        <i class="fas fa-globe"></i>
                    </div>
                    <h3>Ingl√™s Infantil</h3>
                    <p>30 aulas completas para aprender ingl√™s brincando com cores, animais, n√∫meros e muito mais.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='desenhos.html'" style="cursor: pointer;">
                    <div class="feature-icon color">
                        <i class="fas fa-palette"></i>
                    </div>
                    <h3>Desenhos Crist√£os para Colorir</h3>
                    <p>PDFs imprim√≠veis com desenhos que ensinam valores b√≠blicos enquanto a crian√ßa se diverte.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='brincadeiras.html'" style="cursor: pointer;">
                    <div class="feature-icon family">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h3>Brincadeiras em Fam√≠lia</h3>
                    <p>Atividades offline que fortalecem o v√≠nculo entre m√£e e filho, com jogos educativos e criativos.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='brinquedos.html'" style="cursor: pointer;">
                    <div class="feature-icon diy">
                        <i class="fas fa-tools"></i>
                    </div>
                    <h3>Brinquedos DIY</h3>
                    <p>Ideias de brinquedos que a pr√≥pria crian√ßa pode criar, estimulando criatividade e independ√™ncia.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='jogos.html'" style="cursor: pointer;">
                    <div class="feature-icon game">
                        <i class="fas fa-gamepad"></i>
                    </div>
                    <h3>Jogos Interativos</h3>
                    <p>Mini-jogos educativos dentro do pr√≥prio site: mem√≥ria, associa√ß√£o, quebra-cabe√ßas e muito mais.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='videos.html?filter=devocional'" style="cursor: pointer;">
                    <div class="feature-icon devocional">
                        <i class="fas fa-pray"></i>
                    </div>
                    <h3>Devocional Kids</h3>
                    <p>Momentos especiais com Deus para crian√ßas, ensinando valores crist√£os de forma carinhosa e divertida.</p>
                </div>
                
                <div class="feature-card" onclick="window.location.href='censura.html'" style="cursor: pointer;">
                    <div class="feature-icon censura">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Controle Parental</h3>
                    <p>Ferramentas para proteger seu filho online e configurar controles parentais de forma segura.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits">
        <div class="container">
            <h2 class="section-title">Por que escolher o Meu Beb√™ Inteligente?</h2>
            <div class="benefits-list">
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Ambiente 100% seguro e sem propagandas</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Conte√∫do curado por especialistas em educa√ß√£o infantil</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Valores crist√£os em todas as atividades</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Atividades que estimulam o desenvolvimento cognitivo</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Fortece o v√≠nculo familiar com brincadeiras offline</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Acesso ilimitado a todo conte√∫do</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Devocionais infantis para ensinar valores crist√£os</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>Controle parental integrado para m√°xima seguran√ßa</span>
                </div>
                <div class="benefit-item">
                    <i class="fas fa-check-circle"></i>
                    <span>30 aulas de ingl√™s infantil para aprender brincando</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials" class="testimonials">
        <div class="container">
            <h2 class="section-title">O que as m√£es est√£o dizendo</h2>
            <div class="testimonials-grid">
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"Finalmente encontrei um lugar onde posso confiar 100% no conte√∫do que meu filho acessa. As atividades s√£o lindas e realmente educativas!"</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Maria Silva</h4>
                            <span>M√£e do Jo√£o, 4 anos</span>
                        </div>
                    </div>
                </div>
                
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"As brincadeiras em fam√≠lia mudaram nossa rotina! Agora passamos mais tempo juntos e meu filho aprende brincando."</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Ana Costa</h4>
                            <span>M√£e da Sofia, 3 anos</span>
                        </div>
                    </div>
                </div>
                
                <div class="testimonial-card">
                    <div class="testimonial-content">
                        <p>"Adoro os desenhos crist√£os! √â uma forma linda de ensinar valores b√≠blicos para minha filha enquanto ela se diverte colorindo."</p>
                    </div>
                    <div class="testimonial-author">
                        <div class="author-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="author-info">
                            <h4>Patr√≠cia Santos</h4>
                            <span>M√£e da Lara, 5 anos</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing Section -->
    <section id="pricing" class="pricing">
        <div class="container">
            <h2 class="section-title">Escolha seu plano</h2>
            <p class="section-subtitle">Transforme o tempo de tela do seu filho em aprendizado de verdade</p>
            
            <div class="pricing-grid">
                <div class="pricing-card">
                    <div class="pricing-header">
                        <h3>Plano Mensal</h3>
                        <div class="price">
                            <span class="currency">R$</span>
                            <span class="amount">29</span>
                            <span class="period">/m√™s</span>
                        </div>
                    </div>
                    <div class="pricing-features">
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Acesso a todas as playlists</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>V√≠deos educativos sem an√∫ncios</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Desenhos para colorir</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Brincadeiras em fam√≠lia</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Jogos interativos</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Devocional Kids</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Controle parental</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Ingl√™s infantil</span>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="openPaymentModal('monthly')">Assinar Agora</button>
                </div>
                
                <div class="pricing-card featured">
                    <div class="pricing-badge">Mais Popular</div>
                    <div class="pricing-header">
                        <h3>Plano Trimestral</h3>
                        <div class="price">
                            <span class="currency">R$</span>
                            <span class="amount">79</span>
                            <span class="period">/3 meses</span>
                        </div>
                        <div class="savings">Economize R$ 8</div>
                    </div>
                    <div class="pricing-features">
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Acesso a todas as playlists</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>V√≠deos educativos sem an√∫ncios</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Desenhos para colorir</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Brincadeiras em fam√≠lia</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Jogos interativos</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Devocional Kids</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Controle parental</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Ingl√™s infantil</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Suporte priorit√°rio</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="openPaymentModal('quarterly')">Assinar Agora</button>
                </div>
                
                <div class="pricing-card">
                    <div class="pricing-badge">Melhor Valor</div>
                    <div class="pricing-header">
                        <h3>Plano Anual</h3>
                        <div class="price">
                            <span class="currency">R$</span>
                            <span class="amount">290</span>
                            <span class="period">/ano</span>
                        </div>
                        <div class="savings">Economize R$ 58</div>
                    </div>
                    <div class="pricing-features">
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Acesso a todas as playlists</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>V√≠deos educativos sem an√∫ncios</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Desenhos para colorir</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Brincadeiras em fam√≠lia</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Jogos interativos</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Devocional Kids</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Controle parental</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Ingl√™s infantil</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Conte√∫do exclusivo</span>
                        </div>
                        <div class="feature-item">
                            <i class="fas fa-check"></i>
                            <span>Suporte VIP</span>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="openPaymentModal('yearly')">Assinar Agora</button>
                </div>
            </div>
            
            <div class="pricing-guarantee">
                <i class="fas fa-shield-alt"></i>
                <p>Garantia de 7 dias. Se n√£o gostar, devolvemos seu dinheiro.</p>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <div class="cta-content">
                <h2>Pronta para transformar o aprendizado do seu filho?</h2>
                <p>Junte-se a milhares de m√£es que j√° descobriram o lugar seguro e educativo para seus filhos crescerem aprendendo de verdade.</p>
                <button class="btn btn-primary btn-large" onclick="scrollToPricing()">
                    <i class="fas fa-rocket"></i>
                    Come√ßar Agora
                </button>
                <p class="cta-note">‚ú® Garantia de 7 dias, cancele quando quiser</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="nav-brand">
                        <i class="fas fa-heart"></i>
                        <span>Meu Beb√™ Inteligente</span>
                    </div>
                    <p>O lugar seguro e educativo para seu filho crescer aprendendo de verdade.</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Recursos</h4>
                        <a href="musicas.html">M√∫sicas Educativas</a>
                        <a href="videos.html">V√≠deos Seguros</a>
                        <a href="videos.html?filter=devocional">Devocional Kids</a>
                        <a href="desenhos.html">Desenhos Crist√£os</a>
                        <a href="brincadeiras.html">Brincadeiras</a>
                        <a href="jogos.html">Jogos Interativos</a>
                        <a href="censura.html">Controle Parental</a>
                    </div>
                    <div class="footer-column">
                        <h4>Suporte</h4>
                        <a href="#">Central de Ajuda</a>
                        <a href="#">Contato</a>
                        <a href="#">Pol√≠tica de Privacidade</a>
                        <a href="#">Termos de Uso</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Meu Beb√™ Inteligente. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Modal de Login -->
    <div id="loginModal" class="login-modal">
        <div class="login-modal-content">
            <div class="login-header">
                <h2><i class="fas fa-sign-in-alt"></i> Fazer Login</h2>
                <button class="close-btn" onclick="closeLoginModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="login-form">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" placeholder="seu@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Senha:</label>
                        <input type="password" id="loginPassword" placeholder="Digite sua senha" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="loginSubmitBtn">
                        <i class="fas fa-sign-in-alt"></i> Entrar
                    </button>
                </form>
                
                <div class="login-footer">
                    <p>N√£o tem conta? <a href="#" onclick="closeLoginModal(); openPaymentModal('quarterly')">Assine agora</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Pagamento -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-modal-content">
            <div class="payment-header">
                <h2>Finalizar Assinatura</h2>
                <button class="close-modal" onclick="closePaymentModal()">&times;</button>
            </div>
            
            <div class="payment-plan-info">
                <h3 id="selectedPlan">Plano Anual</h3>
                <div class="plan-price">
                    <span class="currency">R$</span>
                    <span class="amount" id="planAmount">290</span>
                    <span class="period" id="planPeriod">/ano</span>
                </div>
            </div>
            
            <!-- Dados de Cadastro -->
            <div class="registration-section">
                <h4>üìß Crie sua conta</h4>
                <p>Preencha seus dados para criar sua conta:</p>
                <div class="registration-form">
                    <div class="form-group">
                        <label for="userEmail">Email:</label>
                        <input type="email" id="userEmail" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="userCPF">CPF:</label>
                        <input type="text" id="userCPF" placeholder="000.000.000-00" maxlength="14" required>
                    </div>
                    <div class="form-group">
                        <label for="userPassword">Senha:</label>
                        <input type="password" id="userPassword" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirmar Senha:</label>
                        <input type="password" id="confirmPassword" placeholder="Digite a senha novamente" required>
                    </div>
                </div>
            </div>
            
            <!-- Orderbump -->
            <div class="orderbump">
                <h4>üéØ Ofertas Especiais para Voc√™:</h4>
                <div class="orderbump-items">
                    <div class="orderbump-item">
                        <input type="checkbox" id="orderbump1" value="19.90">
                        <label for="orderbump1">
                            <strong>R$ 19,90</strong> - Controle parental para nenhum dispositivo da casa ter acesso a sites adultos
                        </label>
                    </div>
                    <div class="orderbump-item">
                        <input type="checkbox" id="orderbump2" value="27.40">
                        <label for="orderbump2">
                            <strong>R$ 27,40</strong> - Um plano alimentar totalmente personalizado para o seu filho
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="payment-methods">
                <h4>Forma de pagamento:</h4>
                <div class="payment-options">
                    <button class="payment-btn pix-btn" onclick="processPayment('pix')">
                        <i class="fas fa-qrcode"></i>
                        PIX
                    </button>
                </div>
            </div>
            
            <!-- √Årea de PIX -->
            <div id="pixArea" class="pix-area" style="display: none;">
                <div class="pix-info">
                    <h4>PIX - Pagamento Instant√¢neo</h4>
                    <p>Escaneie o QR Code ou copie o c√≥digo PIX:</p>
                </div>
                <div class="pix-content">
                    <div class="pix-qr">
                        <div id="pixQRCode" class="qr-code-placeholder">
                            <i class="fas fa-qrcode"></i>
                            <p>QR Code ser√° gerado aqui</p>
                        </div>
                    </div>
                    <div class="pix-copy">
                        <label>C√≥digo PIX (Copiar e Colar):</label>
                        <div class="pix-code-container">
                            <input type="text" id="pixCode" readonly>
                            <button onclick="copyPixCode()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <div class="payment-status">
                        <p><i class="fas fa-clock"></i> Aguardando pagamento...</p>
                    </div>
                </div>
            </div>
            
            <!-- √Årea de Cart√£o -->
            <div id="cardArea" class="card-area" style="display: none;">
                <div class="card-info">
                    <h4><i class="fas fa-credit-card"></i> Cart√£o de Cr√©dito</h4>
                    <p>Preencha os dados do seu cart√£o de forma segura:</p>
                    <div class="security-badges">
                        <span class="badge"><i class="fas fa-shield-alt"></i> SSL Seguro</span>
                        <span class="badge"><i class="fas fa-lock"></i> Dados Protegidos</span>
                    </div>
                </div>
                <div class="card-form">
                    <div class="form-group">
                        <label><i class="fas fa-credit-card"></i> N√∫mero do Cart√£o:</label>
                        <input type="text" id="cardNumber" placeholder="0000 0000 0000 0000" maxlength="19">
                        <small class="form-help">Digite apenas n√∫meros</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-calendar"></i> Validade:</label>
                            <input type="text" id="cardExpiry" placeholder="MM/AA" maxlength="5">
                            <small class="form-help">MM/AA</small>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-key"></i> CVV:</label>
                            <input type="text" id="cardCvv" placeholder="000" maxlength="4">
                            <small class="form-help">3 ou 4 d√≠gitos</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Nome no Cart√£o:</label>
                        <input type="text" id="cardName" placeholder="Nome como est√° no cart√£o">
                        <small class="form-help">Exatamente como aparece no cart√£o</small>
                    </div>
                    <div class="card-brands">
                        <span class="brand">Visa</span>
                        <span class="brand">Mastercard</span>
                        <span class="brand">Elo</span>
                        <span class="brand">American Express</span>
                    </div>
                    <button class="btn btn-primary btn-card" onclick="processCardPayment()">
                        <i class="fas fa-credit-card"></i> 
                        <span>Finalizar Pagamento</span>
                        <small>Processamento seguro</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Vari√°veis globais (declaradas primeiro)
        let selectedPlan = 'quarterly';
        let orderbumpTotal = 0;
        
        // Usar configura√ß√µes do arquivo config.js
        const PAGARME_API_KEY = CONFIG.PAGARME_API_KEY;
        const SUPABASE_URL = CONFIG.SUPABASE_URL;
        const SUPABASE_ANON_KEY = CONFIG.SUPABASE_ANON_KEY;
        const ADMIN_EMAIL = CONFIG.ADMIN_EMAIL;
        const ADMIN_EMAIL_ALT = CONFIG.ADMIN_EMAIL_ALT;
        
        // Fun√ß√£o para scroll suave para a se√ß√£o de pre√ßos
        function scrollToPricing() {
            // Evento de Lead para Meta Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'Lead', {
                    content_name: 'Interesse em Assinatura',
                    content_category: 'Educa√ß√£o Infantil'
                });
            }
            
            const pricingSection = document.getElementById('pricing');
            if (pricingSection) {
                pricingSection.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }
        
        // Configura√ß√£o dos planos
        const PLANS = {
            monthly: { price: 29, duration: 1, period: 'month', name: 'Mensal' },
            quarterly: { price: 79, duration: 3, period: 'months', name: 'Trimestral' },
            yearly: { price: 290, duration: 12, period: 'months', name: 'Anual' }
        };
        
        // Menu mobile para navbar da p√°gina de vendas
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const navMenu = document.getElementById('navMenu');
        
        if (mobileMenuToggle && navMenu) {
            // Garantir que o menu esteja fechado inicialmente
            navMenu.classList.remove('mobile-open');
            
            // Remover event listeners existentes para evitar duplica√ß√£o
            const newToggle = mobileMenuToggle.cloneNode(true);
            mobileMenuToggle.parentNode.replaceChild(newToggle, mobileMenuToggle);
            
            newToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                navMenu.classList.toggle('mobile-open');
            });
            
            // Fechar menu ao clicar fora
            document.addEventListener('click', function(e) {
                if (!navMenu.contains(e.target) && !newToggle.contains(e.target)) {
                    navMenu.classList.remove('mobile-open');
                }
            });
            
            // Fechar menu ao redimensionar para desktop
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    navMenu.classList.remove('mobile-open');
                }
            });
            
            // Fechar menu ao clicar em um link
            const navLinks = navMenu.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    navMenu.classList.remove('mobile-open');
                });
            });
        }
        
        // Fun√ß√µes do modal de pagamento
        function openPaymentModal(plan) {
            selectedPlan = plan;
            
            // Evento de InitiateCheckout para Meta Pixel
            if (typeof fbq !== 'undefined') {
                const planConfig = PLANS[plan];
                fbq('track', 'InitiateCheckout', {
                    value: planConfig.price,
                    currency: 'BRL',
                    content_name: `Plano ${planConfig.name} - Meu Beb√™ Inteligente`,
                    content_category: 'Educa√ß√£o Infantil',
                    content_type: 'subscription',
                    num_items: 1
                });
            }
            
            const modal = document.getElementById('paymentModal');
            const planTitle = document.getElementById('selectedPlan');
            const planAmount = document.getElementById('planAmount');
            const planPeriod = document.getElementById('planPeriod');
            
            const planConfig = PLANS[plan];
            planTitle.textContent = `Plano ${planConfig.name}`;
            planAmount.textContent = planConfig.price;
            planPeriod.textContent = `/${planConfig.period === 'month' ? 'm√™s' : planConfig.period}`;
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        function closePaymentModal() {
            const modal = document.getElementById('paymentModal');
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // Resetar √°reas de pagamento
            document.getElementById('pixArea').style.display = 'none';
            document.getElementById('cardArea').style.display = 'none';
        }
        
        function processPayment(method) {
            // Validar dados de cadastro primeiro
            if (!validateRegistration()) {
                return;
            }
            
            // Calcular total com orderbump
            calculateOrderbumpTotal();
            
            if (method === 'pix') {
                document.getElementById('pixArea').style.display = 'block';
                document.getElementById('cardArea').style.display = 'none';
                generatePixPayment();
            } else if (method === 'card') {
                alert('Pagamento com cart√£o temporariamente indispon√≠vel. Use o PIX para finalizar sua compra.');
                return;
            }
        }
        
        function validateRegistration() {
            const email = document.getElementById('userEmail').value.trim();
            const cpf = document.getElementById('userCPF').value.trim();
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validar email
            if (!email) {
                alert('Por favor, digite seu email.');
                document.getElementById('userEmail').focus();
                return false;
            }
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Por favor, digite um email v√°lido.');
                document.getElementById('userEmail').focus();
                return false;
            }
            
            // Validar CPF
            if (!cpf) {
                alert('Por favor, digite seu CPF.');
                document.getElementById('userCPF').focus();
                return false;
            }
            
            const cpfNumbers = cpf.replace(/\D/g, '');
            if (cpfNumbers.length !== 11) {
                alert('Por favor, digite um CPF v√°lido.');
                document.getElementById('userCPF').focus();
                return false;
            }
            
            // Validar senha
            if (!password) {
                alert('Por favor, digite uma senha.');
                document.getElementById('userPassword').focus();
                return false;
            }
            
            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                document.getElementById('userPassword').focus();
                return false;
            }
            
            // Validar confirma√ß√£o de senha
            if (!confirmPassword) {
                alert('Por favor, confirme sua senha.');
                document.getElementById('confirmPassword').focus();
                return false;
            }
            
            if (password !== confirmPassword) {
                alert('As senhas n√£o coincidem. Por favor, digite novamente.');
                document.getElementById('confirmPassword').focus();
                return false;
            }
            
            return true;
        }
        
        function calculateOrderbumpTotal() {
            orderbumpTotal = 0;
            const orderbump1 = document.getElementById('orderbump1');
            const orderbump2 = document.getElementById('orderbump2');
            
            if (orderbump1.checked) {
                orderbumpTotal += parseFloat(orderbump1.value);
            }
            if (orderbump2.checked) {
                orderbumpTotal += parseFloat(orderbump2.value);
            }
        }
        
        // Vari√°veis globais para controle de pagamento
        let paymentSessionId = null;
        let paymentCheckInterval = null;
        let paymentStartTime = null;
        
        // Fun√ß√£o para obter itens de orderbump selecionados
        function getOrderbumpItems() {
            const orderbumpItems = [];
            
            // Verificar orderbumps selecionados
            const orderbump1 = document.getElementById('orderbump1');
            const orderbump2 = document.getElementById('orderbump2');
            
            if (orderbump1 && orderbump1.checked) {
                orderbumpItems.push({
                    name: 'Controle parental para nenhum dispositivo da casa ter acesso a sites adultos',
                    price: 19.90
                });
            }
            
            if (orderbump2 && orderbump2.checked) {
                orderbumpItems.push({
                    name: 'Um plano alimentar totalmente personalizado para o seu filho',
                    price: 27.40
                });
            }
            
            return orderbumpItems;
        }
        
        // Fun√ß√£o para aplicar m√°scara de CPF
        function formatCPF(value) {
            return value
                .replace(/\D/g, '')
                .replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d)/, '$1.$2')
                .replace(/(\d{3})(\d{1,2})/, '$1-$2')
                .replace(/(-\d{2})\d+?$/, '$1');
        }

        function formatCardNumber(value) {
            // Remove todos os caracteres n√£o num√©ricos
            const numbers = value.replace(/\D/g, '');
            
            // Limita a 16 d√≠gitos
            const limitedNumbers = numbers.substring(0, 16);
            
            // Adiciona espa√ßos a cada 4 d√≠gitos
            return limitedNumbers.replace(/(\d{4})(?=\d)/g, '$1 ');
        }

        function formatCardExpiry(value) {
            // Remove todos os caracteres n√£o num√©ricos
            const numbers = value.replace(/\D/g, '');
            
            // Limita a 4 d√≠gitos
            const limitedNumbers = numbers.substring(0, 4);
            
            // Adiciona barra ap√≥s 2 d√≠gitos
            if (limitedNumbers.length >= 2) {
                return limitedNumbers.substring(0, 2) + '/' + limitedNumbers.substring(2);
            }
            
            return limitedNumbers;
        }

        function formatCardCvv(value) {
            // Remove todos os caracteres n√£o num√©ricos e limita a 4 d√≠gitos
            return value.replace(/\D/g, '').substring(0, 4);
        }

        function formatCardName(value) {
            // Converte para mai√∫sculas e remove caracteres especiais
            return value.toUpperCase().replace(/[^A-Z\s]/g, '');
        }
        
        // Adicionar event listener para m√°scara de CPF
        document.addEventListener('DOMContentLoaded', function() {
            const cpfInput = document.getElementById('userCPF');
            
            if (cpfInput) {
                cpfInput.addEventListener('input', function(e) {
                    e.target.value = formatCPF(e.target.value);
                });
            }

            // Formata√ß√£o autom√°tica dos campos do cart√£o
            const cardNumberInput = document.getElementById('cardNumber');
            const cardExpiryInput = document.getElementById('cardExpiry');
            const cardCvvInput = document.getElementById('cardCvv');
            const cardNameInput = document.getElementById('cardName');

            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    e.target.value = formatCardNumber(e.target.value);
                });
            }

            if (cardExpiryInput) {
                cardExpiryInput.addEventListener('input', function(e) {
                    e.target.value = formatCardExpiry(e.target.value);
                });
            }

            if (cardCvvInput) {
                cardCvvInput.addEventListener('input', function(e) {
                    e.target.value = formatCardCvv(e.target.value);
                });
            }

            if (cardNameInput) {
                cardNameInput.addEventListener('input', function(e) {
                    e.target.value = formatCardName(e.target.value);
                });
            }
        });
        
        async function generatePixPayment() {
            const planConfig = PLANS[selectedPlan];
            const totalAmount = planConfig.price + orderbumpTotal;
            const email = document.getElementById('userEmail').value.trim();
            const cpf = document.getElementById('userCPF').value.trim();
            
            // Validar campos obrigat√≥rios
            if (!email || !cpf) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }
            
            // Gerar ID √∫nico para a sess√£o de pagamento
            paymentSessionId = 'pix_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            paymentStartTime = new Date();
            
            try {
                updatePaymentStatus('Gerando PIX...', 'spinner', '#ffc107');
                
                // Preparar dados do cliente
                const customerData = {
                    name: email.split('@')[0], // Usar parte do email como nome
                    email: email,
                    document: cpf.replace(/\D/g, ''), // Remove formata√ß√£o do CPF
                    phone: '11999999999' // Telefone padr√£o
                };
                
                // Preparar dados do pedido
                const paymentData = {
                    amount: totalAmount,
                    customer: customerData,
                    plan: planConfig,
                    orderbumpItems: getOrderbumpItems(),
                    paymentMethod: 'pix'
                };
                
                console.log('üì¶ Criando pedido via backend:', paymentData);
                
                // Chamar endpoint do backend
                const response = await fetch('/api/create-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(paymentData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    console.log('‚úÖ Pedido criado com sucesso:', result);
                    
                    // Salvar ID do pedido
                    paymentSessionId = result.order_id;
                
                    // Extrair QR Code da resposta
                    const qrCode = result.charges?.[0]?.last_transaction?.qr_code;
                    const qrCodeUrl = result.charges?.[0]?.last_transaction?.qr_code_url;
                    console.log('üîç QR Code extra√≠do:', qrCode ? 'Sim' : 'N√£o');
                    console.log('üîç QR Code URL:', qrCodeUrl ? 'Sim' : 'N√£o');
                    
                    // Gerar QR Code
                    const qrCodeElement = document.getElementById('pixQRCode');
                    if (qrCodeElement && qrCode) {
                        qrCodeElement.innerHTML = '';
                        
                        // Verificar se a biblioteca QRCode est√° carregada
                        
                        if (typeof QRCode !== 'undefined') {
                            try {
                                QRCode.toCanvas(qrCodeElement, qrCode, {
                                    width: 100,
                                    height: 100,
                                    color: {
                                        dark: '#000000',
                                        light: '#FFFFFF'
                                    }
                                });
                                console.log('‚úÖ QR Code gerado com sucesso');
                            } catch (error) {
                                console.error('‚ùå Erro ao gerar QR Code:', error);
                                // Fallback: mostrar o c√≥digo PIX como texto
                                qrCodeElement.innerHTML = `
                                    <div style="padding: 10px; text-align: center; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px; width: 100px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                        <i class="fas fa-qrcode" style="font-size: 24px; color: #6c757d; margin-bottom: 5px;"></i>
                                        <p style="margin: 0; font-size: 8px; color: #6c757d;">Erro QR Code</p>
                                        <p style="margin: 2px 0 0 0; font-size: 7px; color: #6c757d;">Use c√≥digo PIX</p>
                                    </div>
                                `;
                            }
                        } else {
                            // Usar fallback imediatamente para ser mais r√°pido
                            showQRCodeFallback(qrCodeElement, qrCodeUrl);
                        }
                    } else {
                        console.error('‚ùå QR Code n√£o encontrado na resposta');
                    }
                    
                    // Atualizar c√≥digo PIX
                    const pixCodeElement = document.getElementById('pixCode');
                    if (pixCodeElement && qrCode) {
                        pixCodeElement.value = qrCode;
                    }
                
                    // Atualizar status
                    updatePaymentStatus('PIX gerado!', 'check', '#28a745');
                    
                    // Iniciar verifica√ß√£o de pagamento
                    startRealPaymentVerification();
                    
                } else {
                    console.error('‚ùå Erro ao criar pedido:', result);
                    updatePaymentStatus(`Erro ao gerar PIX: ${result.error || 'Erro desconhecido'}`, 'times', '#dc3545');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao gerar PIX:', error);
                updatePaymentStatus('Erro ao gerar PIX. Tente novamente.', 'times', '#dc3545');
            }
        }
        
        function generateQRCode(text) {
            // Usar biblioteca QR Code (j√° inclu√≠da no HTML)
            const qrContainer = document.getElementById('qrcode');
            if (qrContainer && typeof QRCode !== 'undefined') {
                qrContainer.innerHTML = '';
                new QRCode(qrContainer, {
                    text: text,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
        }
        
        function showQRCodeFallback(element, qrCodeUrl = null) {
            // Fallback: mostrar o c√≥digo PIX como texto ou URL do QR Code
            if (qrCodeUrl) {
                element.innerHTML = `
                    <div style="padding: 20px; text-align: center; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px;">
                        <div style="margin-bottom: 15px;">
                            <img src="${qrCodeUrl}" alt="QR Code PIX" style="max-width: 200px; max-height: 200px; border: 1px solid #dee2e6; border-radius: 8px;" 
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                            <div style="display: none;">
                                <i class="fas fa-qrcode" style="font-size: 48px; color: #6c757d; margin-bottom: 10px;"></i>
                                <p style="margin: 0; font-size: 12px; color: #6c757d;">QR Code n√£o dispon√≠vel</p>
                            </div>
                        </div>
                        <p style="margin: 5px 0 0 0; font-size: 10px; color: #6c757d;">Use o c√≥digo PIX abaixo</p>
                        <a href="${qrCodeUrl}" target="_blank" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; font-size: 12px;">
                            <i class="fas fa-external-link-alt"></i> Abrir QR Code
                        </a>
                    </div>
                `;
            } else {
                element.innerHTML = `
                    <div style="padding: 20px; text-align: center; background: #f8f9fa; border: 2px dashed #dee2e6; border-radius: 8px;">
                        <i class="fas fa-qrcode" style="font-size: 48px; color: #6c757d; margin-bottom: 10px;"></i>
                        <p style="margin: 0; font-size: 12px; color: #6c757d;">QR Code n√£o dispon√≠vel</p>
                        <p style="margin: 5px 0 0 0; font-size: 10px; color: #6c757d;">Use o c√≥digo PIX abaixo</p>
                    </div>
                `;
            }
        }
        
        function startRealPaymentVerification() {
            // Verificar pagamento a cada 10 segundos
            paymentCheckInterval = setInterval(() => {
                checkRealPaymentStatus();
            }, 10000);
            
            // Timeout de 1 hora (tempo de expira√ß√£o do PIX)
            setTimeout(() => {
                if (paymentCheckInterval) {
                    clearInterval(paymentCheckInterval);
                    updatePaymentStatus('PIX expirado. Tente novamente.', 'times', '#dc3545');
                }
            }, 60 * 60 * 1000);
        }
        
        async function checkRealPaymentStatus() {
            if (!paymentSessionId) return;
            
            try {
                const response = await fetch(`/api/check-payment?orderId=${paymentSessionId}`);
                
                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    // Verificar se o pagamento foi confirmado
                    if (result.status === 'paid') {
                        confirmPayment();
                        return;
                    }
                    
                    // Timer removido para simplificar
                } else {
                    console.error('Erro na verifica√ß√£o:', result.error);
                }
                
            } catch (error) {
                console.error('Erro ao verificar pagamento:', error);
                // Continuar tentando mesmo com erro
            }
        }
        
        function confirmPayment() {
            // Parar verifica√ß√£o
            if (paymentCheckInterval) {
                clearInterval(paymentCheckInterval);
                paymentCheckInterval = null;
            }
            
            // Atualizar status
            updatePaymentStatus('Pagamento confirmado! Criando sua conta...', 'check-circle', '#28a745');
            
            // Criar conta do usu√°rio
            setTimeout(() => {
                createUserAccount('pix');
            }, 2000);
        }
        
        function updatePaymentStatus(message, icon, color) {
            const statusElement = document.querySelector('.payment-status p');
            if (statusElement) {
                statusElement.innerHTML = `<i class="fas fa-${icon}" style="color: ${color};"></i> ${message}`;
            }
        }
        
        
        function copyPixCode() {
            const pixCode = document.getElementById('pixCode');
            pixCode.select();
            pixCode.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            // Feedback visual
            const button = event.target.closest('button');
            const originalHTML = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check"></i>';
            button.style.background = '#28a745';
            
            setTimeout(() => {
                button.innerHTML = originalHTML;
                button.style.background = '';
            }, 2000);
        }
        
        async function processCardPayment() {
            // Validar dados de cadastro novamente
            if (!validateRegistration()) {
                return;
            }
            
            const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
            const cardExpiry = document.getElementById('cardExpiry').value;
            const cardCvv = document.getElementById('cardCvv').value;
            const cardName = document.getElementById('cardName').value;
            const email = document.getElementById('userEmail').value.trim();
            
            if (!cardNumber || !cardExpiry || !cardCvv || !cardName) {
                alert('Por favor, preencha todos os campos do cart√£o.');
                return;
            }
            
            // Validar formato do cart√£o
            if (!validateCard(cardNumber, cardExpiry, cardCvv)) {
                alert('Dados do cart√£o inv√°lidos. Verifique e tente novamente.');
                return;
            }
            
            const planConfig = PLANS[selectedPlan];
            const totalAmount = planConfig.price + orderbumpTotal;
            
            // Gerar ID √∫nico para a sess√£o de pagamento
            paymentSessionId = 'card_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            const button = event.target;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
            button.disabled = true;
            
            try {
                updatePaymentStatus('Processando cart√£o...', 'spinner', '#ffc107');
                
                console.log('üí≥ Iniciando processamento do cart√£o...');
                console.log('üí≥ Dados do cart√£o:', {
                    number: cardNumber,
                    expiry: cardExpiry,
                    cvv: cardCvv,
                    name: cardName
                });
                
                // Preparar dados do cliente
                const customerData = {
                    name: cardName,
                    email: email,
                    document: document.getElementById('userCPF').value.trim().replace(/\D/g, ''),
                    phone: '11999999999'
                };

                console.log('üë§ Dados do cliente:', customerData);

                // Preparar dados do pedido para nossa API
                const orderData = {
                    amount: totalAmount,
                    customer: customerData,
                    plan: planConfig,
                    orderbumpItems: getOrderbumpItems(),
                    paymentMethod: 'credit_card',
                    card: {
                        number: cardNumber,
                        holder_name: cardName,
                        exp_month: parseInt(cardExpiry.split('/')[0]),
                        exp_year: parseInt('20' + cardExpiry.split('/')[1]),
                        cvv: cardCvv
                    }
                };

                console.log('üì¶ Dados do pedido:', orderData);
                
                // Usar nossa API para processar o pagamento (resolve problemas de CORS)
                console.log('üöÄ Enviando requisi√ß√£o para API...');
                const response = await fetch('/api/create-payment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                console.log('üì° Status da resposta:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error('‚ùå Erro na API:', errorData);
                    throw new Error(errorData.message || `Erro na API: ${response.status}`);
                }
                
                const order = await response.json();
                
                console.log('üí≥ Resposta completa do pagamento:', order);
                console.log('üí≥ Status do pedido:', order.status);
                console.log('üí≥ Charges:', order.charges);
                console.log('üí≥ Payment approved:', order.payment_approved);
                
                // Salvar ID do pedido
                paymentSessionId = order.id;
                
                // Verificar status do pagamento
                console.log('üîç Verificando status do pagamento...');
                console.log('üîç order.payment_approved:', order.payment_approved);
                console.log('üîç order.status:', order.status);
                
                if (order.charges && order.charges.length > 0) {
                    const charge = order.charges[0];
                    console.log('üîç Primeira charge:', charge);
                    console.log('üîç Charge status:', charge.status);
                    if (charge.last_transaction) {
                        console.log('üîç Last transaction:', charge.last_transaction);
                        console.log('üîç Transaction status:', charge.last_transaction.status);
                        console.log('üîç Transaction success:', charge.last_transaction.success);
                        console.log('üîç Gateway response:', charge.last_transaction.gateway_response);
                        console.log('üîç Gateway message:', charge.last_transaction.gateway_message);
                        console.log('üîç Acquirer response:', charge.last_transaction.acquirer_response);
                        
                        // Log detalhado dos erros do gateway
                        if (charge.last_transaction.gateway_response && charge.last_transaction.gateway_response.errors) {
                            console.log('‚ùå Erros do gateway:', JSON.stringify(charge.last_transaction.gateway_response.errors, null, 2));
                        }
                    }
                }
                
                if (order.payment_approved || order.status === 'paid') {
                    console.log('‚úÖ Pagamento aprovado!');
                    updatePaymentStatus('Pagamento aprovado! Criando sua conta...', 'check-circle', '#28a745');
                    setTimeout(() => {
                        createUserAccount('card');
                    }, 2000);
                } else {
                    console.error('‚ùå Pagamento n√£o aprovado. Status:', order.status, 'Charges:', order.charges);
                    throw new Error('Pagamento n√£o foi aprovado');
                }
                
            } catch (error) {
                console.error('Erro ao processar cart√£o:', error);
                updatePaymentStatus('Erro no pagamento. Tente novamente.', 'times', '#dc3545');
                alert(`Erro ao processar pagamento: ${error.message}`);
            } finally {
                button.innerHTML = '<i class="fas fa-credit-card"></i> Pagar com Cart√£o';
                button.disabled = false;
            }
        }
        
        function validateCard(cardNumber, expiry, cvv) {
            // Valida√ß√£o b√°sica de cart√£o
            const cardRegex = /^[0-9]{13,19}$/;
            const expiryRegex = /^(0[1-9]|1[0-2])\/([0-9]{2})$/;
            const cvvRegex = /^[0-9]{3,4}$/;
            
            if (!cardRegex.test(cardNumber) || !expiryRegex.test(expiry) || !cvvRegex.test(cvv)) {
                return false;
            }
            
            // Validar se √© um cart√£o de teste v√°lido
            const testCards = [
                '4111111111111111', // Visa
                '5555555555554444', // Mastercard
                '378282246310005',  // American Express
                '6011111111111117'  // Discover
            ];
            
            const cleanNumber = cardNumber.replace(/\s/g, '');
            if (!testCards.includes(cleanNumber)) {
                alert('Por favor, use um cart√£o de teste v√°lido:\n\n' +
                      'Visa: 4111 1111 1111 1111\n' +
                      'Mastercard: 5555 5555 5555 4444\n' +
                      'American Express: 3782 822463 10005\n' +
                      'Discover: 6011 1111 1111 1117');
                return false;
            }
            
            return true;
        }
        
        async function createUserAccount(paymentMethod = 'pix') {
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value;
            const plan = selectedPlan;
            const planConfig = PLANS[plan];
            
            // Calcular data de expira√ß√£o
            const startDate = new Date();
            const endDate = new Date();
            endDate.setMonth(endDate.getMonth() + planConfig.duration);
            
            try {
                // Inicializar Supabase se n√£o estiver inicializado
                console.log('üîÑ Verificando Supabase...');
                
                if (typeof window.supabase === 'undefined' || !window.supabase || !window.supabase.auth) {
                    console.log('üîÑ Inicializando Supabase...');
                    await initSupabase();
                }
                
                // Verificar se o Supabase foi inicializado corretamente
                if (typeof window.supabase === 'undefined' || !window.supabase.auth) {
                    console.error('‚ùå Supabase ainda n√£o est√° dispon√≠vel');
                    throw new Error('Supabase n√£o foi inicializado corretamente');
                }
                
                console.log('‚úÖ Supabase pronto para uso');
                
                // Criar usu√°rio usando o sistema de autentica√ß√£o do Supabase
                const { data, error } = await window.supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) {
                    throw new Error(`Erro ao criar conta: ${error.message}`);
                }
                
                console.log('‚úÖ Usu√°rio criado com sucesso:', data);
                
                // Salvar dados do usu√°rio no localStorage
                const userData = {
                    email: email,
                    plan: plan,
                    plan_name: planConfig.name,
                    plan_duration: planConfig.duration,
                    plan_price: planConfig.price,
                    start_date: startDate.toISOString(),
                    end_date: endDate.toISOString(),
                    status: 'active',
                    payment_method: paymentMethod,
                    payment_status: 'confirmed',
                    payment_session_id: paymentSessionId
                };
                
                localStorage.setItem('userAccount', JSON.stringify(userData));
                localStorage.setItem('userEmail', email);
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('userPlan', planConfig.name);
                localStorage.setItem('userEndDate', endDate.toISOString());
                localStorage.setItem('paymentConfirmed', 'true');
                localStorage.setItem('isAdmin', 'false');
                
                // Fechar modal de pagamento
                closePaymentModal();
                
                // Mostrar mensagem de sucesso
                showSuccessMessage(email, planConfig.name, endDate);
                
            } catch (error) {
                console.error('Erro ao criar conta:', error);
                alert(`Erro ao criar conta: ${error.message}\n\nTente novamente ou entre em contato com o suporte.`);
            }
        }
        
        async function hashPassword(password) {
            
            try {
                const encoder = new TextEncoder();
                const data = encoder.encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', data);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                
                return hashHex;
            } catch (error) {
                throw new Error('Erro ao processar senha');
            }
        }
        
        async function initSupabase() {
            console.log('üîÑ Inicializando Supabase...');
            
            // Aguardar um pouco para garantir que a biblioteca foi carregada
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Verificar se a biblioteca supabase est√° dispon√≠vel globalmente
            if (typeof window.supabase === 'undefined' || !window.supabase || !window.supabase.createClient) {
                console.log('üì¶ Aguardando biblioteca Supabase carregar...');
                
                // Aguardar at√© 10 segundos para a biblioteca carregar
                let attempts = 0;
                const maxAttempts = 10;
                
                while (attempts < maxAttempts) {
                    if (typeof window.supabase !== 'undefined' && window.supabase.createClient) {
                        console.log('‚úÖ Biblioteca Supabase encontrada');
                        break;
                    }
                    console.log(`‚è≥ Tentativa ${attempts + 1}/${maxAttempts} - Aguardando Supabase...`);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    attempts++;
                }
                
                if (typeof window.supabase === 'undefined' || !window.supabase.createClient) {
                    throw new Error('Biblioteca Supabase n√£o carregou ap√≥s 10 segundos');
                }
            }
            
            try {
                console.log('üîÑ Criando cliente Supabase...');
                window.supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
                console.log('‚úÖ Cliente Supabase criado com sucesso');
                
                // Testar a conex√£o
                const { data, error } = await window.supabase.from('users').select('count').limit(1);
                if (error) {
                    console.warn('‚ö†Ô∏è Aviso ao testar conex√£o:', error.message);
                } else {
                    console.log('‚úÖ Conex√£o com Supabase testada com sucesso');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao criar cliente Supabase:', error);
                throw error;
            }
        }
        
        function showSuccessMessage(email, planName, endDate) {
            // Eventos do Pixel da Meta para Purchase
            const planPrices = {
                'Mensal': 29,
                'Trimestral': 79,
                'Anual': 290
            };
            
            const planPrice = planPrices[planName] || 29;
            
            // Evento de Purchase para Meta Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'Purchase', {
                    value: planPrice,
                    currency: 'BRL',
                    content_name: `Plano ${planName} - Meu Beb√™ Inteligente`,
                    content_category: 'Educa√ß√£o Infantil',
                    content_type: 'subscription',
                    email: email
                });
                
                // Evento personalizado para convers√£o
                fbq('trackCustom', 'SubscriptionPurchase', {
                    plan_name: planName,
                    plan_price: planPrice,
                    currency: 'BRL',
                    user_email: email,
                    subscription_duration: planName === 'Mensal' ? '1 month' : planName === 'Trimestral' ? '3 months' : '12 months'
                });
            }
            
            // Enviar dados para Conversions API (Server-Side)
            if (typeof META_PIXEL_CONFIG !== 'undefined') {
                META_PIXEL_CONFIG.sendCustomerData(email, planName, planPrice, {
                    userId: email, // Usando email como ID √∫nico
                    subscriptionId: `sub_${Date.now()}_${planName.toLowerCase()}`,
                    transactionId: `txn_${Date.now()}_${planName.toLowerCase()}`, // ID da transa√ß√£o
                    country: 'BR',
                    state: 'SP', // Voc√™ pode coletar isso no formul√°rio
                    city: 'S√£o Paulo' // Voc√™ pode coletar isso no formul√°rio
                });
            }
            
            // Criar modal de sucesso
            const successModal = document.createElement('div');
            successModal.className = 'success-modal';
            successModal.innerHTML = `
                <div class="success-content">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2>üéâ Bem-vinda ao Meu Beb√™ Inteligente!</h2>
                    <div class="success-details">
                        <p><strong>Email:</strong> ${email}</p>
                        <p><strong>Plano:</strong> ${planName}</p>
                        <p><strong>V√°lido at√©:</strong> ${endDate.toLocaleDateString('pt-BR')}</p>
                    </div>
                    <p class="success-message">Sua conta foi criada com sucesso! Agora voc√™ tem acesso completo √† plataforma.</p>
                    <button onclick="redirectToDashboard()" class="btn btn-primary">
                        <i class="fas fa-arrow-right"></i> Acessar Dashboard
                    </button>
                    <p style="margin-top: 15px; font-size: 14px; color: #6c757d;">
                        <i class="fas fa-clock"></i> Redirecionando automaticamente em <span id="countdown">5</span> segundos...
                    </p>
                </div>
            `;
            
            document.body.appendChild(successModal);
            document.body.style.overflow = 'hidden';
            
            // Countdown autom√°tico para redirecionamento
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdownElement) {
                    countdownElement.textContent = countdown;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    redirectToDashboard();
                }
            }, 1000);
        }
        
        function redirectToDashboard() {
            // Remover modal de sucesso
            const successModal = document.querySelector('.success-modal');
            if (successModal) {
                successModal.remove();
            }
            document.body.style.overflow = 'auto';
            
            // Limpar qualquer countdown ativo
            const countdownElements = document.querySelectorAll('#countdown');
            countdownElements.forEach(element => {
                if (element.parentElement) {
                    element.parentElement.remove();
                }
            });
            
            // Redirecionar para dashboard
            window.location.href = 'dashboard.html';
        }
        
        // Fun√ß√µes do Modal de Login
        function openLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }
        
        function closeLoginModal() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
        
        // Sistema de Login Unificado
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const submitBtn = document.getElementById('loginSubmitBtn');
            
            
            if (!email || !password) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            // Mostrar loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verificando...';
            submitBtn.disabled = true;
            
            try {
                // Verificar se √© admin (aceita vers√£o correta e com erro de digita√ß√£o)
                const isAdminEmail = email.toLowerCase() === ADMIN_EMAIL.toLowerCase() || 
                                   email.toLowerCase() === ADMIN_EMAIL_ALT.toLowerCase();
                
                if (isAdminEmail) {
                    await loginAsAdmin(email, password);
                } else {
                    await loginAsUser(email, password);
                }
                
            } catch (error) {
                console.error('Erro no login:', error);
                
                // Mensagem de erro mais espec√≠fica
                let errorMessage = 'Erro ao fazer login. ';
                if (error.message.includes('supabase') || error.message.includes('banco de dados')) {
                    errorMessage += 'Problema de conex√£o com o banco de dados. Tente novamente em alguns instantes.';
                } else if (error.message.includes('Senha incorreta')) {
                    errorMessage += 'Senha incorreta. Verifique e tente novamente.';
                } else if (error.message.includes('Usu√°rio n√£o encontrado')) {
                    errorMessage += 'Usu√°rio n√£o encontrado. Verifique o email ou crie uma conta.';
                } else if (error.message.includes('assinatura expirou')) {
                    errorMessage += 'Sua assinatura expirou. Renove para continuar acessando.';
                } else {
                    errorMessage += 'Verifique suas credenciais e tente novamente.';
                }
                
                alert(errorMessage);
            } finally {
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Entrar';
                submitBtn.disabled = false;
            }
        });
        
        async function loginAsAdmin(email, password) {
            // Verificar senha do admin
            const correctPassword = CONFIG.ADMIN_PASSWORD;
            
            if (password !== correctPassword) {
                throw new Error('Senha incorreta');
            }
            
            // Verificar se o admin existe no banco (opcional)
            try {
                const { data: adminUser, error } = await supabase
                    .from('users')
                    .select('*')
                    .eq('email', email)
                    .eq('plan', 'admin')
                    .single();
            } catch (error) {
                // Erro silencioso
            }
            
            // Salvar dados do admin
            const adminData = {
                isAdmin: 'true',
                adminEmail: email,
                isLoggedIn: 'true',
                userPlan: 'Administrador',
                paymentConfirmed: 'true',
                adminLoginTime: new Date().toISOString()
            };
            
            Object.entries(adminData).forEach(([key, value]) => {
                localStorage.setItem(key, value);
            });
            
            // Fechar modal
            closeLoginModal();
            
            // Redirecionar para dashboard com privil√©gios admin
            window.location.href = 'dashboard.html';
        }
        
        async function loginAsUser(email, password) {
            // Inicializar Supabase
            if (typeof window.supabase === 'undefined' || !window.supabase) {
                await initSupabase();
            }
            
            // Verificar se o cliente foi criado corretamente
            if (!window.supabase || !window.supabase.auth) {
                await initSupabase();
                
                if (!window.supabase || !window.supabase.auth) {
                    throw new Error('Erro ao inicializar conex√£o com o banco de dados');
                }
            }
            
            // Fazer login usando o sistema de autentica√ß√£o do Supabase
            console.log('üîê Tentando fazer login com:', { email, passwordLength: password.length });
            
            const { data, error } = await window.supabase.auth.signInWithPassword({
                email: email,
                password: password
            });
            
            console.log('üîê Resultado do login:', { data, error });
            
            if (error) {
                console.error('‚ùå Erro detalhado do Supabase:', error);
                
                if (error.message.includes('Invalid login credentials')) {
                    throw new Error('Email ou senha incorretos');
                } else if (error.message.includes('Email not confirmed')) {
                    // Para usu√°rios que pagaram, permitir login mesmo sem confirma√ß√£o de email
                    console.log('‚ö†Ô∏è Email n√£o confirmado, mas verificando se √© usu√°rio pagante...');
                    
                    // Verificar se o usu√°rio tem dados de pagamento no localStorage
                    const userAccount = localStorage.getItem('userAccount');
                    if (userAccount) {
                        console.log('‚úÖ Usu√°rio tem dados de pagamento - permitindo login');
                        // Continuar com o login mesmo sem confirma√ß√£o
                    } else {
                        throw new Error('Email n√£o confirmado. Verifique sua caixa de entrada.');
                    }
                } else if (error.message.includes('User not found')) {
                    throw new Error('Usu√°rio n√£o encontrado. Verifique se voc√™ fez o pagamento corretamente.');
                } else {
                    throw new Error('Erro ao fazer login: ' + error.message);
                }
            }
            
            // Verificar se o usu√°rio tem dados salvos no localStorage (assinatura ativa)
            const userAccount = localStorage.getItem('userAccount');
            const userEndDate = localStorage.getItem('userEndDate');
            
            if (userEndDate) {
                const endDate = new Date(userEndDate);
                const now = new Date();
                
                if (now > endDate) {
                    throw new Error('Sua assinatura expirou. Renove para continuar acessando.');
                }
            }
            
            // Salvar dados do usu√°rio
            const userData = {
                userEmail: email,
                isLoggedIn: 'true',
                paymentConfirmed: 'true',
                isAdmin: 'false'
            };
            
            // Adicionar dados do plano se existirem
            if (userAccount) {
                const accountData = JSON.parse(userAccount);
                userData.userPlan = accountData.plan_name;
                userData.userEndDate = accountData.end_date;
            }
            
            Object.entries(userData).forEach(([key, value]) => {
                localStorage.setItem(key, value);
            });
            
            // Fechar modal
            closeLoginModal();
            
            // Redirecionar para dashboard
            window.location.href = 'dashboard.html';
        }
        
        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('paymentModal');
            if (event.target === modal) {
                closePaymentModal();
            }
        }
    </script>
</body>
</html>
